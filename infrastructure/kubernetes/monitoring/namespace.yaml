apiVersion: v1
kind: Namespace
metadata:
  name: example-monitoring
  labels:
    name: example-monitoring
    monitoring: enabled
---
# External Secret for Grafana
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: grafana-secrets
  namespace: example-monitoring
spec:
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: grafana-secrets
    creationPolicy: Owner
  data:
    - secretKey: admin-password
      remoteRef:
        key: secret/monitoring/grafana
        property: admin-password
    - secretKey: secret-key
      remoteRef:
        key: secret/monitoring/grafana
        property: secret-key
    - secretKey: smtp-password
      remoteRef:
        key: secret/monitoring/grafana
        property: smtp-password
---
# External Secret for Grafana Database
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: grafana-db-secret
  namespace: example-monitoring
spec:
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: grafana-db-secret
    creationPolicy: Owner
  data:
    - secretKey: username
      remoteRef:
        key: secret/monitoring/grafana-db
        property: username
    - secretKey: password
      remoteRef:
        key: secret/monitoring/grafana-db
        property: password
---
# External Secret for AlertManager
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: alertmanager-secrets
  namespace: example-monitoring
spec:
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: alertmanager-secrets
    creationPolicy: Owner
  data:
    - secretKey: sendgrid-api-key
      remoteRef:
        key: secret/monitoring/alertmanager
        property: sendgrid-api-key
    - secretKey: slack-webhook-url
      remoteRef:
        key: secret/monitoring/alertmanager
        property: slack-webhook-url