<?xml version="1.0"?>
<!DOCTYPE module PUBLIC
    "-//Checkstyle//DTD Checkstyle Configuration 1.3//EN"
    "https://checkstyle.org/dtds/configuration_1_3.dtd">

<!--
    Waqiti Platform - Production Checkstyle Rules

    CRITICAL: These rules enforce production-ready code quality and prevent common financial software bugs.

    Financial Safety Rules:
    - Prohibit double/float for money amounts (use BigDecimal)
    - Prohibit System.out/err (use SLF4J logging)
    - Prohibit empty catch blocks
    - Enforce proper exception handling

    Code Quality Rules:
    - Enforce consistent naming conventions
    - Enforce proper documentation
    - Enforce proper formatting

    Integration with CI/CD:
    - Add to Maven/Gradle build: ./mvnw checkstyle:check
    - Fail build on violations
    - Generate reports in target/checkstyle-result.xml
-->

<module name="Checker">
    <!-- File-level checks -->
    <property name="severity" value="error"/>

    <!-- ============================================ -->
    <!-- CRITICAL: System.out/System.err prohibition -->
    <!-- ============================================ -->
    <module name="RegexpSingleline">
        <property name="format" value="System\.(out|err)\."/>
        <property name="message" value="CRITICAL: Do not use System.out or System.err. Use SLF4J logger instead. EXCEPTIONS: CLI tools (main methods), last-resort fallbacks when logging system fails (must be documented with comment)."/>
        <property name="severity" value="error"/>
        <!-- Allow in specific files -->
        <property name="fileNamePattern" value="^(?!.*(JwtSecretGenerator|PCIAuditLogger|SecureLoggingService|AlertService|NotificationFallbackService|AlertsEmergencyConsumer|AlertNotificationService)).*\.java$"/>
    </module>

    <!-- ============================================ -->
    <!-- CRITICAL: double/float for money prohibition -->
    <!-- ============================================ -->
    <module name="RegexpSingleline">
        <property name="format" value="(private|public|protected)\s+(double|float)\s+\w*(amount|balance|price|fee|total|cost|value|payment|charge|refund|credit|debit)\w*"/>
        <property name="message" value="CRITICAL FINANCIAL BUG: Never use double or float for money amounts. Use java.math.BigDecimal instead to prevent precision loss in financial calculations."/>
        <property name="severity" value="error"/>
    </module>

    <!-- ============================================ -->
    <!-- Code Quality Rules -->
    <!-- ============================================ -->

    <module name="TreeWalker">

        <!-- Prohibit empty catch blocks -->
        <module name="EmptyCatchBlock">
            <property name="severity" value="error"/>
            <property name="exceptionVariableName" value="expected|ignore"/>
            <message key="catch.block.empty"
                     value="Empty catch block detected. Either handle the exception properly, log it, or rename the exception variable to 'expected' or 'ignore' if intentionally suppressing."/>
        </module>

        <!-- Enforce proper exception logging -->
        <module name="IllegalCatch">
            <property name="illegalClassNames" value="java.lang.Exception, java.lang.Throwable, java.lang.RuntimeException"/>
            <property name="severity" value="warning"/>
            <message key="illegal.catch"
                     value="Avoid catching generic Exception/Throwable. Catch specific exceptions or document why generic catch is needed."/>
        </module>

        <!-- Enforce TODO comment format -->
        <module name="TodoComment">
            <property name="format" value="(TODO|FIXME|XXX)"/>
            <property name="severity" value="warning"/>
            <message key="todo.match"
                     value="TODO comment found. Please create a JIRA ticket and reference it in the comment: TODO(TICKET-123): Description"/>
        </module>

        <!-- Naming conventions -->
        <module name="ConstantName">
            <property name="format" value="^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$"/>
            <property name="severity" value="error"/>
        </module>

        <module name="LocalVariableName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
            <property name="severity" value="error"/>
        </module>

        <module name="MemberName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
            <property name="severity" value="error"/>
        </module>

        <module name="MethodName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
            <property name="severity" value="error"/>
        </module>

        <module name="PackageName">
            <property name="format" value="^[a-z]+(\.[a-z][a-z0-9]*)*$"/>
            <property name="severity" value="error"/>
        </module>

        <module name="ParameterName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
            <property name="severity" value="error"/>
        </module>

        <module name="TypeName">
            <property name="format" value="^[A-Z][a-zA-Z0-9]*$"/>
            <property name="severity" value="error"/>
        </module>

        <!-- Code complexity limits -->
        <module name="CyclomaticComplexity">
            <property name="max" value="15"/>
            <property name="severity" value="warning"/>
            <message key="cyclomaticComplexity"
                     value="Method complexity is {0} (max allowed is {1}). Consider refactoring into smaller methods."/>
        </module>

        <module name="MethodLength">
            <property name="max" value="150"/>
            <property name="severity" value="warning"/>
            <message key="maxLen.method"
                     value="Method length is {0} lines (max allowed is {1}). Consider refactoring into smaller methods."/>
        </module>

        <!-- Import rules -->
        <module name="AvoidStarImport">
            <property name="severity" value="error"/>
        </module>

        <module name="UnusedImports">
            <property name="severity" value="error"/>
        </module>

        <!-- Whitespace rules -->
        <module name="WhitespaceAfter">
            <property name="tokens" value="COMMA, SEMI"/>
            <property name="severity" value="error"/>
        </module>

        <module name="WhitespaceAround">
            <property name="tokens" value="ASSIGN, BAND, BAND_ASSIGN, BOR, BOR_ASSIGN, BSR, BSR_ASSIGN, BXOR, BXOR_ASSIGN, COLON, DIV, DIV_ASSIGN, EQUAL, GE, GT, LAND, LCURLY, LE, LITERAL_ASSERT, LITERAL_CATCH, LITERAL_DO, LITERAL_ELSE, LITERAL_FINALLY, LITERAL_FOR, LITERAL_IF, LITERAL_RETURN, LITERAL_SYNCHRONIZED, LITERAL_TRY, LITERAL_WHILE, LOR, LT, MINUS, MINUS_ASSIGN, MOD, MOD_ASSIGN, NOT_EQUAL, PLUS, PLUS_ASSIGN, QUESTION, RCURLY, SL, SLIST, SL_ASSIGN, SR, SR_ASSIGN, STAR, STAR_ASSIGN, TYPE_EXTENSION_AND"/>
            <property name="severity" value="error"/>
        </module>

        <!-- Modifier order -->
        <module name="ModifierOrder">
            <property name="severity" value="error"/>
        </module>

        <!-- Require @Override annotation -->
        <module name="MissingOverride">
            <property name="severity" value="error"/>
        </module>

        <!-- Prohibit fall-through in switch statements -->
        <module name="FallThrough">
            <property name="severity" value="error"/>
        </module>

        <!-- Require default case in switch -->
        <module name="MissingSwitchDefault">
            <property name="severity" value="warning"/>
        </module>

    </module>

    <!-- File length limits -->
    <module name="FileLength">
        <property name="max" value="2000"/>
        <property name="severity" value="warning"/>
        <message key="maxLen.file"
                 value="File length is {0} lines (max recommended is {1}). Consider refactoring into multiple files."/>
    </module>

    <!-- Line length limits -->
    <module name="LineLength">
        <property name="max" value="150"/>
        <property name="severity" value="warning"/>
        <property name="ignorePattern" value="^package.*|^import.*|a href|href|http://|https://|ftp://"/>
    </module>

    <!-- Require newline at end of file -->
    <module name="NewlineAtEndOfFile">
        <property name="severity" value="error"/>
    </module>

</module>
